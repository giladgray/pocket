(function() {
  var GRAVITY, colors, countElem, curColor, i, nextColor, numBalls, pocket, random, randomBall, start, updateCount, _i;

  random = function(min, max) {
    if (max == null) {
      max = min;
      min = 0;
    }
    return Math.floor(Math.random() * (max - min)) + min;
  };

  numBalls = 0;

  countElem = document.querySelector('.count');

  updateCount = function(delta) {
    if (delta) {
      numBalls += delta;
    } else {
      numBalls = 0;
    }
    return countElem.textContent = numBalls;
  };

  pocket = new Pocket;

  pocket.component('context-2d', function(cmp, _arg) {
    var canvas, resize;
    canvas = _arg.canvas;
    cmp.canvas = document.querySelector(canvas || '#canvas');
    cmp.g2d = cmp.canvas.getContext('2d');
    cmp.center = {
      x: 0,
      y: 0
    };
    window.addEventListener('resize', resize = function() {
      cmp.canvas.width = document.body.clientWidth;
      cmp.canvas.height = document.body.clientHeight;
      cmp.width = cmp.canvas.width;
      cmp.height = cmp.canvas.height;
      cmp.center.x = cmp.canvas.width / 2;
      return cmp.center.y = cmp.canvas.height / 2;
    });
    return resize();
  });

  pocket.key({
    'context-2d': null
  });

  pocket.component('keyboard-state', function(cmp, _arg) {
    var keymap, target;
    target = _arg.target, keymap = _arg.keymap;
    cmp.target = target || document;
    cmp.down = {};
    cmp.isNewPress = function(keyName, recency) {
      var delta, downTime;
      if (recency == null) {
        recency = 16;
      }
      downTime = cmp.down[keyName];
      delta = Date.now() - downTime;
      return downTime && (0 < delta && delta < recency);
    };
    cmp.target.addEventListener('keydown', function(e) {
      var keyName;
      keyName = keymap[e.which];
      cmp.down[e.which] = true;
      if (keyName && !cmp.down[keyName]) {
        return cmp.down[keyName] = Date.now();
      }
    });
    return cmp.target.addEventListener('keyup', function(e) {
      var keyName;
      keyName = keymap[e.which];
      cmp.down[e.which] = false;
      if (keyName) {
        return cmp.down[keyName] = 0;
      }
    });
  });

  pocket.key({
    'input': null,
    'keyboard-state': {
      keymap: {
        13: 'ADD',
        32: 'DESTROY'
      }
    }
  });

  pocket.systemForEach('input-balls', ['keyboard-state'], function(pocket, key, keyboard) {
    if (keyboard.isNewPress('DESTROY')) {
      pocket.destroyKeys(pocket.filterKeys('ball'));
      updateCount(0);
    }
    if (keyboard.isNewPress('ADD')) {
      return randomBall();
    }
  });

  pocket.component('position', {
    x: 0,
    y: 0
  });

  pocket.component('velocity', {
    x: 0,
    y: 0
  });

  pocket.component('circle', {
    radius: 30,
    color: 'red'
  });

  colors = ['seagreen', 'navy', 'indigo', 'firebrick', 'goldenrod'];

  curColor = 0;

  nextColor = function() {
    var color;
    color = colors[curColor++];
    curColor %= colors.length;
    return color;
  };

  randomBall = function() {
    var height, radius, width, _ref;
    updateCount(1);
    _ref = pocket.getData('context-2d'), width = _ref.width, height = _ref.height;
    radius = random(20, 100);
    return pocket.key({
      ball: true,
      position: {
        x: random(radius, width - radius),
        y: random(radius, height / 2 - radius)
      },
      velocity: {
        x: random(-8, 8),
        y: 0
      },
      circle: {
        radius: radius,
        color: nextColor()
      }
    });
  };

  for (i = _i = 0; _i < 5; i = ++_i) {
    randomBall();
  }


  /* NOW IT'S IDENTICAL TO BOUNCE! DEMO */

  GRAVITY = 0.5;

  pocket.systemForEach('gravity', ['velocity'], function(pocket, key, vel) {
    return vel.y += GRAVITY;
  });

  pocket.systemForEach('move', ['position', 'velocity'], function(pocket, key, pos, vel) {
    pos.x += vel.x;
    return pos.y += vel.y;
  });

  pocket.system('clear-canvas', [], function(pocket) {
    var g2d, height, width, _ref;
    _ref = pocket.getData('context-2d'), g2d = _ref.g2d, width = _ref.width, height = _ref.height;
    return g2d.clearRect(0, 0, width, height);
  });

  pocket.systemForEach('draw-ball', ['position', 'circle'], function(pocket, key, pos, circle) {
    var g2d;
    g2d = pocket.getData('context-2d').g2d;
    g2d.beginPath();
    g2d.fillStyle = circle.color;
    g2d.arc(pos.x, pos.y, circle.radius, 0, Math.PI * 2);
    g2d.closePath();
    return g2d.fill();
  });

  pocket.systemForEach('bounce', ['position', 'velocity', 'circle'], function(pkt, key, pos, vel, _arg) {
    var height, radius, width, _ref;
    radius = _arg.radius;
    _ref = pkt.getData('context-2d'), width = _ref.width, height = _ref.height;
    if (pos.x < radius || pos.x > width - radius) {
      vel.x *= -1;
      pos.x += vel.x;
    }
    if (pos.y < radius || pos.y > height - radius) {
      vel.y *= -1;
      return pos.y += vel.y;
    }
  });

  start = function(time) {
    pocket.tick(time);
    return window.requestAnimationFrame(start);
  };

  document.addEventListener('DOMContentLoaded', function() {
    return start();
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvdW5jZS1wcm8vYm91bmNlLXByby5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBLGdIQUFBOztBQUFBLEVBQUEsTUFBQSxHQUFTLFNBQUMsR0FBRCxFQUFNLEdBQU4sR0FBQTtBQUNQLElBQUEsSUFBTyxXQUFQO0FBQ0UsTUFBQSxHQUFBLEdBQU0sR0FBTixDQUFBO0FBQUEsTUFDQSxHQUFBLEdBQU0sQ0FETixDQURGO0tBQUE7QUFHQSxXQUFPLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBSSxDQUFDLE1BQUwsQ0FBQSxDQUFBLEdBQWdCLENBQUMsR0FBQSxHQUFNLEdBQVAsQ0FBM0IsQ0FBQSxHQUEwQyxHQUFqRCxDQUpPO0VBQUEsQ0FBVCxDQUFBOztBQUFBLEVBT0EsUUFBQSxHQUFXLENBUFgsQ0FBQTs7QUFBQSxFQVFBLFNBQUEsR0FBWSxRQUFRLENBQUMsYUFBVCxDQUF1QixRQUF2QixDQVJaLENBQUE7O0FBQUEsRUFTQSxXQUFBLEdBQWMsU0FBQyxLQUFELEdBQUE7QUFDWixJQUFBLElBQUcsS0FBSDtBQUFjLE1BQUEsUUFBQSxJQUFZLEtBQVosQ0FBZDtLQUFBLE1BQUE7QUFDSyxNQUFBLFFBQUEsR0FBVyxDQUFYLENBREw7S0FBQTtXQUVBLFNBQVMsQ0FBQyxXQUFWLEdBQXdCLFNBSFo7RUFBQSxDQVRkLENBQUE7O0FBQUEsRUFjQSxNQUFBLEdBQVMsR0FBQSxDQUFBLE1BZFQsQ0FBQTs7QUFBQSxFQWlCQSxNQUFNLENBQUMsU0FBUCxDQUFpQixZQUFqQixFQUErQixTQUFDLEdBQUQsRUFBTSxJQUFOLEdBQUE7QUFDN0IsUUFBQSxjQUFBO0FBQUEsSUFEb0MsU0FBRCxLQUFDLE1BQ3BDLENBQUE7QUFBQSxJQUFBLEdBQUcsQ0FBQyxNQUFKLEdBQWEsUUFBUSxDQUFDLGFBQVQsQ0FBdUIsTUFBQSxJQUFVLFNBQWpDLENBQWIsQ0FBQTtBQUFBLElBQ0EsR0FBRyxDQUFDLEdBQUosR0FBVSxHQUFHLENBQUMsTUFB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QSxHQUFRLE1BQXJDO0FBQ0UsTUFBQSxHQUFHLENBQUMsQ0FBSixJQUFTLENBQUEsQ0FBVCxDQUFBO0FBQUEsTUFDQSxHQUFHLENBQUMsQ0FBSixJQUFTLEdBQUcsQ0FBQyxDQURiLENBREY7S0FEQTtBQUlBLElBQUEsSUFBRyxHQUFHLENBQUMsQ0FBSixHQUFRLE1BQVIsSUFBa0IsR0FBRyxDQUFDLENBQUosR0FBUSxNQUFBLEdBQVMsTUFBdEM7QUFDRSxNQUFBLEdBQUcsQ0FBQyxDQUFKLElBQVMsQ0FBQSxDQUFULENBQUE7YUFDQSxHQUFHLENBQUMsQ0FBSixJQUFTLEdBQUcsQ0FBQyxFQUZmO0tBTGlFO0VBQUEsQ0FBbkUsQ0FuSUEsQ0FBQTs7QUFBQSxFQTZJQSxLQUFBLEdBQVEsU0FBQyxJQUFELEdBQUE7QUFDTixJQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVksSUFBWixDQUFBLENBQUE7V0FDQSxNQUFNLENBQUMscUJBQVAsQ0FBNkIsS0FBN0IsRUFGTTtFQUFBLENBN0lSLENBQUE7O0FBQUEsRUFpSkEsUUFBUSxDQUFDLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxTQUFBLEdBQUE7V0FBRyxLQUFBLENBQUEsRUFBSDtFQUFBLENBQTlDLENBakpBLENBQUE7QUFBQSIsImZpbGUiOiJib3VuY2UtcHJvL2JvdW5jZS1wcm8uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJyYW5kb20gPSAobWluLCBtYXgpIC0+XG4gIHVubGVzcyBtYXg/XG4gICAgbWF4ID0gbWluXG4gICAgbWluID0gMFxuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikpICsgbWluXG5cbiMgdHJhY2sgbnVtYmVyIG9mIGJhbGxzIG9uIHRoZSBzY3JlZW5cbm51bUJhbGxzID0gMFxuY291bnRFbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciAnLmNvdW50J1xudXBkYXRlQ291bnQgPSAoZGVsdGEpIC0+XG4gIGlmIGRlbHRhIHRoZW4gbnVtQmFsbHMgKz0gZGVsdGFcbiAgZWxzZSBudW1CYWxscyA9IDBcbiAgY291bnRFbGVtLnRleHRDb250ZW50ID0gbnVtQmFsbHNcblxucG9ja2V0ID0gbmV3IFBvY2tldFxuXG4jIGNvbnRleHQtMmQgY29tcG9uZW50IGZvciBzdG9yaW5nIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBhbmQgb3RoZXIgY2FudmFzIGluZm9cbnBvY2tldC5jb21wb25lbnQgJ2NvbnRleHQtMmQnLCAoY21wLCB7Y2FudmFzfSkgLT5cbiAgY21wLmNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgY2FudmFzIG9yICcjY2FudmFzJ1xuICBjbXAuZzJkID0gY21wLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG4gIGNtcC5jZW50ZXIgPSB7eDogMCwgeTogMH1cblxuICAjIGVuc3VyZSBjYW52YXMgaXMgYXMgbGFyZ2UgYXMgcG9zc2libGVcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgJ3Jlc2l6ZScsIHJlc2l6ZSA9IC0+XG4gICAgY21wLmNhbnZhcy53aWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGhcbiAgICBjbXAuY2FudmFzLmhlaWdodCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0XG4gICAgY21wLndpZHRoID0gY21wLmNhbnZhcy53aWR0aFxuICAgIGNtcC5oZWlnaHQgPSBjbXAuY2FudmFzLmhlaWdodFxuICAgIGNtcC5jZW50ZXIueCA9IGNtcC5jYW52YXMud2lkdGggLyAyXG4gICAgY21wLmNlbnRlci55ID0gY21wLmNhbnZhcy5oZWlnaHQgLyAyXG4gIHJlc2l6ZSgpXG5cbiMgdGhlIGNvbnRleHQtMmQgZGF0YSBvYmplY3RcbnBvY2tldC5rZXkgeydjb250ZXh0LTJkJzogbnVsbH1cblxuIyBtYWludGFpbiBrZXlib2FyZCBzdGF0ZS4gdGhpcyBndXkgbXV0YXRlcyBoaW1zZWxmLCBpdCdzIHByZXR5IGJhZGFzc1xucG9ja2V0LmNvbXBvbmVudCAna2V5Ym9hcmQtc3RhdGUnLCAoY21wLCB7dGFyZ2V0LCBrZXltYXB9KSAtPlxuICBjbXAudGFyZ2V0ID0gdGFyZ2V0IG9yIGRvY3VtZW50XG4gIGNtcC5kb3duID0ge31cbiAgIyByZXR1cm5zIHRydWUgaWYgdGhlIG5hbWVkIGtleSB3YXMgcHJlc3NlZCBpbiB0aGUgbGFzdCBYIG1pbGxpc2Vjb25kc1xuICBjbXAuaXNOZXdQcmVzcyA9IChrZXlOYW1lLCByZWNlbmN5ID0gMTYpIC0+XG4gICAgZG93blRpbWUgPSBjbXAuZG93bltrZXlOYW1lXVxuICAgIGRlbHRhID0gRGF0ZS5ub3coKSAtIGRvd25UaW1lXG4gICAgcmV0dXJuIGRvd25UaW1lIGFuZCAwIDwgZGVsdGEgPCByZWNlbmN5XG5cbiAgY21wLnRhcmdldC5hZGRFdmVudExpc3RlbmVyICdrZXlkb3duJywgKGUpIC0+XG4gICAga2V5TmFtZSA9IGtleW1hcFtlLndoaWNoXVxuICAgIGNtcC5kb3duW2Uud2hpY2hdID0gdHJ1ZVxuICAgIGlmIGtleU5hbWUgYW5kIG5vdCBjbXAuZG93bltrZXlOYW1lXVxuICAgICAgIyByZWNvcmQgdGltZSBpdCB3YXMgcHJlc3NlZFxuICAgICAgY21wLmRvd25ba2V5TmFtZV0gPSBEYXRlLm5vdygpXG5cbiAgY21wLnRhcmdldC5hZGRFdmVudExpc3RlbmVyICdrZXl1cCcsIChlKSAtPlxuICAgIGtleU5hbWUgPSBrZXltYXBbZS53aGljaF1cbiAgICBjbXAuZG93bltlLndoaWNoXSA9IGZhbHNlXG4gICAgaWYga2V5TmFtZVxuICAgICAgY21wLmRvd25ba2V5TmFtZV0gPSAwXG5cbiMgdGhlIGtleWJvYXJkLXN0YXRlIGRhdGEgb2JqZWN0XG5wb2NrZXQua2V5XG4gICdpbnB1dCc6IG51bGxcbiAgJ2tleWJvYXJkLXN0YXRlJzpcbiAgICBrZXltYXA6XG4gICAgICAxMzogJ0FERCdcbiAgICAgIDMyOiAnREVTVFJPWSdcblxuIyBrZXlib2FyZCBjb21tYW5kc1xucG9ja2V0LnN5c3RlbUZvckVhY2ggJ2lucHV0LWJhbGxzJywgWydrZXlib2FyZC1zdGF0ZSddLCAocG9ja2V0LCBrZXksIGtleWJvYXJkKSAtPlxuICBpZiBrZXlib2FyZC5pc05ld1ByZXNzICdERVNUUk9ZJ1xuICAgIHBvY2tldC5kZXN0cm95S2V5cyBwb2NrZXQuZmlsdGVyS2V5cygnYmFsbCcpXG4gICAgdXBkYXRlQ291bnQoMClcbiAgaWYga2V5Ym9hcmQuaXNOZXdQcmVzcyAnQUREJ1xuICAgIHJhbmRvbUJhbGwoKVxuXG4jIGJhbGwgY29tcG9uZW50c1xucG9ja2V0LmNvbXBvbmVudCAncG9zaXRpb24nLCB7eDogMCwgeTogMH1cbnBvY2tldC5jb21wb25lbnQgJ3ZlbG9jaXR5Jywge3g6IDAsIHk6IDB9XG5wb2NrZXQuY29tcG9uZW50ICdjaXJjbGUnLCAgIHtyYWRpdXM6IDMwLCBjb2xvcjogJ3JlZCd9XG5cbiMgY3ljbGUgdGhyb3VnaCBjb2xvcnNcbmNvbG9ycyA9IFsnc2VhZ3JlZW4nLCAnbmF2eScsICdpbmRpZ28nLCAnZmlyZWJyaWNrJywgJ2dvbGRlbnJvZCddXG5jdXJDb2xvciA9IDBcbm5leHRDb2xvciA9IC0+XG4gIGNvbG9yID0gY29sb3JzW2N1ckNvbG9yKytdXG4gIGN1ckNvbG9yICU9IGNvbG9ycy5sZW5ndGhcbiAgcmV0dXJuIGNvbG9yXG5cbiMgbWFrZSBhIGJhbGwgd2l0aCByYW5kb20gYXR0cmlidXRlc1xucmFuZG9tQmFsbCA9IC0+XG4gIHVwZGF0ZUNvdW50KDEpXG4gIHt3aWR0aCwgaGVpZ2h0fSA9IHBvY2tldC5nZXREYXRhICdjb250ZXh0LTJkJ1xuICByYWRpdXMgPSByYW5kb20oMjAsIDEwMClcbiAgcG9ja2V0LmtleSB7XG4gICAgYmFsbDogdHJ1ZVxuICAgIHBvc2l0aW9uIDpcbiAgICAgIHg6IHJhbmRvbShyYWRpdXMsIHdpZHRoIC0gcmFkaXVzKVxuICAgICAgeTogcmFuZG9tKHJhZGl1cywgaGVpZ2h0IC8gMiAtIHJhZGl1cylcbiAgICB2ZWxvY2l0eSA6IHt4OiByYW5kb20oLTgsIDgpLCB5OiAwfVxuICAgIGNpcmNsZSAgIDoge3JhZGl1cywgY29sb3I6IG5leHRDb2xvcigpfVxuICB9XG5cbiMgc3RhcnQgd2l0aCA1IG9mIHRoZW1cbnJhbmRvbUJhbGwoKSBmb3IgaSBpbiBbMC4uLjVdXG5cbiMjIyBOT1cgSVQnUyBJREVOVElDQUwgVE8gQk9VTkNFISBERU1PICMjI1xuXG4jIGFwcGx5IGdyYXZpdHkgdG8gZXZlcnkgdGhpbmcgd2l0aCBhIHZlbG9jaXR5XG5HUkFWSVRZID0gMC41XG5wb2NrZXQuc3lzdGVtRm9yRWFjaCAnZ3Jhdml0eScsIFsndmVsb2NpdHknXSwgKHBvY2tldCwga2V5LCB2ZWwpIC0+XG4gIHZlbC55ICs9IEdSQVZJVFlcblxuIyBtb3ZlIGVhY2ggYmFsbFxucG9ja2V0LnN5c3RlbUZvckVhY2ggJ21vdmUnLCBbJ3Bvc2l0aW9uJywgJ3ZlbG9jaXR5J10sIChwb2NrZXQsIGtleSwgcG9zLCB2ZWwpIC0+XG4gIHBvcy54ICs9IHZlbC54XG4gIHBvcy55ICs9IHZlbC55XG5cbiMgY2xlYXIgdGhlIGNhbnZhcyBlYWNoIGZyYW1lXG5wb2NrZXQuc3lzdGVtICdjbGVhci1jYW52YXMnLCBbXSwgKHBvY2tldCkgLT5cbiAge2cyZCwgd2lkdGgsIGhlaWdodH0gPSBwb2NrZXQuZ2V0RGF0YSAnY29udGV4dC0yZCdcbiAgZzJkLmNsZWFyUmVjdCAwLCAwLCB3aWR0aCwgaGVpZ2h0XG5cbiMgZHJhdyBlYWNoIGJhbGxzXG5wb2NrZXQuc3lzdGVtRm9yRWFjaCAnZHJhdy1iYWxsJywgWydwb3NpdGlvbicsICdjaXJjbGUnXSwgKHBvY2tldCwga2V5LCBwb3MsIGNpcmNsZSkgLT5cbiAge2cyZH0gPSBwb2NrZXQuZ2V0RGF0YSAnY29udGV4dC0yZCdcbiAgZzJkLmJlZ2luUGF0aCgpXG4gIGcyZC5maWxsU3R5bGUgPSBjaXJjbGUuY29sb3JcbiAgZzJkLmFyYyBwb3MueCwgcG9zLnksIGNpcmNsZS5yYWRpdXMsIDAsIE1hdGguUEkgKiAyXG4gIGcyZC5jbG9zZVBhdGgoKVxuICBnMmQuZmlsbCgpXG5cbiMgYm91bmNlIGVhY2ggYmFsbCB3aGVuIHRoZXkgcmVhY2ggdGhlIGVkZ2Ugb2YgdGhlIGNhbnZhc1xucG9ja2V0LnN5c3RlbUZvckVhY2ggJ2JvdW5jZScsIFsncG9zaXRpb24nLCAndmVsb2NpdHknLCAnY2lyY2xlJ10sIChwa3QsIGtleSwgcG9zLCB2ZWwsIHtyYWRpdXN9KSAtPlxuICB7d2lkdGgsIGhlaWdodH0gPSBwa3QuZ2V0RGF0YSAnY29udGV4dC0yZCdcbiAgaWYgcG9zLnggPCByYWRpdXMgb3IgcG9zLnggPiB3aWR0aCAtIHJhZGl1c1xuICAgIHZlbC54ICo9IC0xXG4gICAgcG9zLnggKz0gdmVsLnhcbiAgaWYgcG9zLnkgPCByYWRpdXMgb3IgcG9zLnkgPiBoZWlnaHQgLSByYWRpdXNcbiAgICB2ZWwueSAqPSAtMVxuICAgIHBvcy55ICs9IHZlbC55XG5cbiMgcmVuZGVyIGxvb3BcbnN0YXJ0ID0gKHRpbWUpIC0+XG4gIHBvY2tldC50aWNrKHRpbWUpXG4gIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgc3RhcnRcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAnRE9NQ29udGVudExvYWRlZCcsIC0+IHN0YXJ0KClcbiJdfQ==